# 👻 ماژول امنیتی Ghost
**ابزار سخت‌افزاری امنیت Windows و Azure مبتنی بر PowerShell**

> **سخت‌سازی فعال امنیت برای endpoints ویندوز و محیط‌های Azure.** Ghost توابع سخت‌سازی مبتنی بر PowerShell ارائه می‌دهد که می‌تواند با غیرفعال کردن سرویس‌ها و پروتکل‌های غیرضروری به کاهش بردارهای حمله رایج کمک کند.

## ⚠️ هشدارهای مهم

**تست الزامی است**: همیشه ابتدا Ghost را در محیط‌های غیرتولیدی تست کنید. غیرفعال کردن سرویس‌ها ممکن است بر عملکردهای تجاری مشروع تأثیر بگذارد.

**هیچ ضمانتی وجود ندارد**: در حالی که Ghost بردارهای حمله رایج را هدف قرار می‌دهد، هیچ ابزار امنیتی نمی‌تواند همه حملات را پیش‌گیری کند. این یکی از اجزای استراتژی امنیتی جامع است.

**تأثیر عملیاتی**: برخی توابع ممکن است بر عملکرد سیستم تأثیر بگذارند. هر تنظیم را قبل از استقرار به دقت بررسی کنید.

**ارزیابی حرفه‌ای**: برای محیط‌های تولیدی، با متخصصان امنیت مشورت کنید تا اطمینان حاصل کنید که تنظیمات با نیازهای سازمان شما همراستا است.

## 📊 چشم‌انداز امنیت

خسارات باج‌افزار به **۵۷ میلیارد دلار در سال ۲۰۲۵** رسید، تحقیقات نشان می‌دهد که بسیاری از حملات موفق از سرویس‌های اساسی ویندوز و پیکربندی‌های نادرست سوءاستفاده می‌کنند. بردارهای حمله رایج شامل:

- **۹۰٪ از وقایع باج‌افزار** شامل سوءاستفاده از RDP می‌شود
- **آسیب‌پذیری‌های SMBv1** حملاتی مانند WannaCry و NotPetya را امکان‌پذیر کرد
- **ماکروهای سند** روش اولیه تحویل بدافزار باقی می‌مانند
- **حملات مبتنی بر USB** همچنان شبکه‌های منقطع از هوا را هدف قرار می‌دهند
- **سوءاستفاده از PowerShell** در سال‌های اخیر به طور قابل توجهی افزایش یافته است

## 🛡️ توابع امنیتی Ghost

Ghost **۱۶ تابع سخت‌سازی ویندوز** به اضافه **یکپارچگی امنیت Azure** ارائه می‌دهد:

### سخت‌سازی Endpoint ویندوز

| تابع | هدف | ملاحظات |
|----------|---------|----------------|
| `Set-RDP` | دسترسی Remote Desktop را مدیریت می‌کند | ممکن است بر مدیریت راه دور تأثیر بگذارد |
| `Set-SMBv1` | پروتکل SMB قدیمی را کنترل می‌کند | برای سیستم‌های بسیار قدیمی ضروری است |
| `Set-AutoRun` | AutoPlay/AutoRun را کنترل می‌کند | ممکن است بر راحتی کاربر تأثیر بگذارد |
| `Set-USBStorage` | دستگاه‌های ذخیره‌سازی USB را محدود می‌کند | ممکن است بر استفاده مشروع از USB تأثیر بگذارد |
| `Set-Macros` | اجرای ماکروی Office را کنترل می‌کند | ممکن است بر اسناد فعال شده با ماکرو تأثیر بگذارد |
| `Set-PSRemoting` | PowerShell remoting را مدیریت می‌کند | ممکن است بر مدیریت راه دور تأثیر بگذارد |
| `Set-WinRM` | Windows Remote Management را کنترل می‌کند | ممکن است بر مدیریت راه دور تأثیر بگذارد |
| `Set-LLMNR` | پروتکل وضوح نام را مدیریت می‌کند | معمولاً غیرفعال کردن آن ایمن است |
| `Set-NetBIOS` | NetBIOS روی TCP/IP را کنترل می‌کند | ممکن است بر برنامه‌های قدیمی تأثیر بگذارد |
| `Set-AdminShares` | اشتراک‌های مدیریتی را مدیریت می‌کند | ممکن است بر دسترسی راه دور به فایل تأثیر بگذارد |
| `Set-Telemetry` | جمع‌آوری داده را کنترل می‌کند | ممکن است بر قابلیت‌های تشخیصی تأثیر بگذارد |
| `Set-GuestAccount` | حساب مهمان را مدیریت می‌کند | معمولاً غیرفعال کردن آن ایمن است |
| `Set-ICMP` | پاسخ‌های ping را کنترل می‌کند | ممکن است بر تشخیص شبکه تأثیر بگذارد |
| `Set-RemoteAssistance` | Remote Assistance را مدیریت می‌کند | ممکن است بر عملیات help desk تأثیر بگذارد |
| `Set-NetworkDiscovery` | کشف شبکه را کنترل می‌کند | ممکن است بر مرور شبکه تأثیر بگذارد |
| `Set-Firewall` | Windows Firewall را مدیریت می‌کند | برای امنیت شبکه حیاتی است |

### امنیت ابر Azure

| تابع | هدف | الزامات |
|----------|---------|--------------|
| `Set-AzureSecurityDefaults` | امنیت پایه Azure AD را فعال می‌کند | مجوزهای Microsoft Graph |
| `Set-AzureConditionalAccess` | سیاست‌های دسترسی را پیکربندی می‌کند | لایسنس Azure AD P1/P2 |
| `Set-AzurePrivilegedUsers` | حساب‌های ممتاز را ممیزی می‌کند | مجوزهای Global Admin |

### گزینه‌های استقرار سازمانی

| روش | مورد استفاده | الزامات |
|--------|----------|--------------|
| **اجرای مستقیم** | تست، محیط‌های کوچک | حقوق مدیر محلی |
| **Group Policy** | محیط‌های دامنه | مدیر دامنه، مدیریت GP |
| **Microsoft Intune** | دستگاه‌های مدیریت شده ابری | لایسنس Intune، Graph API |

## 🚀 شروع سریع

### ارزیابی امنیت
```powershell
# بارگذاری ماژول Ghost
IEX(Invoke-WebRequest 'https://raw.githubusercontent.com/jimrtyler/Ghost/main/Ghost.ps1')

# بررسی وضعیت امنیتی فعلی
Get-Ghost
```

### سخت‌سازی پایه (ابتدا تست کنید)
```powershell
# سخت‌سازی ضروری - ابتدا در محیط آزمایشگاه تست کنید
Set-Ghost -SMBv1 -AutoRun -Macros

# بررسی تغییرات
Get-Ghost
```

### استقرار سازمانی
```powershell
# استقرار Group Policy (محیط‌های دامنه)
Set-Ghost -SMBv1 -AutoRun -GroupPolicy

# استقرار Intune (دستگاه‌های مدیریت شده ابری)
Set-Ghost -SMBv1 -RDP -USBStorage -Intune
```

## 📋 روش‌های نصب

### گزینه ۱: دانلود مستقیم (تست)
```powershell
IEX(Invoke-WebRequest 'https://raw.githubusercontent.com/jimrtyler/Ghost/main/Ghost.ps1')
```

### گزینه ۲: نصب ماژول
```powershell
# نصب از PowerShell Gallery (در صورت دسترسی)
Install-Module Ghost -Scope CurrentUser
Import-Module Ghost
```

### گزینه ۳: استقرار سازمانی
```powershell
# کپی به مکان شبکه برای استقرار Group Policy
# پیکربندی اسکریپت‌های PowerShell Intune برای استقرار ابری
```

## 💼 نمونه‌های مورد استفاده

### کسب‌وکار کوچک
```powershell
# حفاظت پایه با حداقل تأثیر
Set-Ghost -SMBv1 -AutoRun -Macros -ICMP
```

### محیط مراقبت بهداشتی
```powershell
# سخت‌سازی متمرکز بر HIPAA
Set-Ghost -SMBv1 -RDP -USBStorage -AdminShares -Telemetry
```

### خدمات مالی
```powershell
# پیکربندی امنیت بالا
Set-Ghost -RDP -SMBv1 -AutoRun -USBStorage -Macros -PSRemoting -AdminShares
```

### سازمان ابر محور
```powershell
# استقرار مدیریت شده Intune
Connect-IntuneGhost -Interactive
Set-Ghost -SMBv1 -RDP -AutoRun -Macros -Intune
```

## 🔍 جزئیات توابع

### توابع سخت‌سازی اصلی

#### سرویس‌های شبکه
- **RDP**: دسترسی دسکتاپ راه دور را مسدود می‌کند یا پورت را تصادفی می‌کند
- **SMBv1**: پروتکل قدیمی اشتراک فایل را غیرفعال می‌کند
- **ICMP**: پاسخ‌های ping را برای شناسایی جلوگیری می‌کند
- **LLMNR/NetBIOS**: پروتکل‌های قدیمی وضوح نام را مسدود می‌کند

#### امنیت برنامه
- **ماکروها**: اجرای ماکرو در برنامه‌های Office را غیرفعال می‌کند
- **AutoRun**: اجرای خودکار از رسانه‌های قابل جابجایی را جلوگیری می‌کند

#### مدیریت راه دور
- **PSRemoting**: جلسات راه دور PowerShell را غیرفعال می‌کند
- **WinRM**: Windows Remote Management را متوقف می‌کند
- **Remote Assistance**: اتصالات کمک راه دور را مسدود می‌کند

#### کنترل دسترسی
- **Admin Shares**: اشتراک‌های C$، ADMIN$ را غیرفعال می‌کند
- **Guest Account**: دسترسی حساب مهمان را غیرفعال می‌کند
- **USB Storage**: استفاده از دستگاه USB را محدود می‌کند

### یکپارچگی Azure
```powershell
# اتصال به tenant Azure
Connect-AzureGhost -Interactive

# فعال‌سازی پیش‌فرض‌های امنیتی
Set-AzureSecurityDefaults -Enable

# پیکربندی دسترسی شرطی
Set-AzureConditionalAccess -BlockLegacyAuth -RequireMFA

# ممیزی کاربران ممتاز
Set-AzurePrivilegedUsers -AuditOnly
```

### یکپارچگی Intune (جدید در v2)
```powershell
# اتصال به Intune
Connect-IntuneGhost -Interactive

# استقرار از طریق سیاست‌های Intune
Set-IntuneGhost -Settings @{
    RDP = $true
    SMBv1 = $true
    USBStorage = $true
    Macros = $true
}
```

## ⚠️ ملاحظات مهم

### الزامات تست
- **محیط آزمایشگاه**: ابتدا همه تنظیمات را در محیط ایزوله تست کنید
- **استقرار مرحله‌ای**: به تدریج استقرار دهید تا مشکلات را شناسایی کنید
- **طرح بازگشت**: اطمینان حاصل کنید که در صورت نیاز می‌توانید تغییرات را برگردانید
- **مستندسازی**: ثبت کنید که کدام تنظیمات برای محیط شما کار می‌کند

### تأثیر بالقوه
- **بهره‌وری کاربر**: برخی تنظیمات ممکن است بر گردش کار روزانه تأثیر بگذارد
- **برنامه‌های قدیمی**: سیستم‌های قدیمی ممکن است به پروتکل‌های خاص نیاز داشته باشند
- **دسترسی راه دور**: تأثیر بر مدیریت راه دور مشروع را در نظر بگیرید
- **فرآیندهای تجاری**: تأیید کنید که تنظیمات عملکردهای حیاتی را نمی‌شکند

### محدودیت‌های امنیتی
- **دفاع عمقی**: Ghost یک لایه امنیتی است، نه راه‌حل کامل
- **مدیریت مداوم**: امنیت نیاز به نظارت و به‌روزرسانی مداوم دارد
- **آموزش کاربر**: کنترل فنی باید با آگاهی امنیتی همراه باشد
- **تکامل تهدید**: روش‌های حمله جدید ممکن است حفاظت‌های فعلی را دور بزنند

## 🎯 نمونه‌های سناریو حمله

در حالی که Ghost بردارهای حمله رایج را هدف قرار می‌دهد، پیش‌گیری خاص به پیاده‌سازی و تست مناسب بستگی دارد:

### حملات سبک WannaCry
- **کاهش**: `Set-Ghost -SMBv1` پروتکل آسیب‌پذیر را غیرفعال می‌کند
- **ملاحظات**: اطمینان حاصل کنید که هیچ سیستم قدیمی به SMBv1 نیاز ندارد

### باج‌افزار مبتنی بر RDP
- **کاهش**: `Set-Ghost -RDP` دسترسی دسکتاپ راه دور را مسدود می‌کند
- **ملاحظات**: ممکن است به روش‌های جایگزین دسترسی راه دور نیاز باشد

### بدافزار مبتنی بر سند
- **کاهش**: `Set-Ghost -Macros` اجرای ماکرو را غیرفعال می‌کند
- **ملاحظات**: ممکن است بر اسناد مشروع فعال شده با ماکرو تأثیر بگذارد

### تهدیدات تحویلی USB
- **کاهش**: `Set-Ghost -USBStorage -AutoRun` عملکرد USB را محدود می‌کند
- **ملاحظات**: ممکن است بر استفاده مشروع از دستگاه USB تأثیر بگذارد

## 🏢 ویژگی‌های سازمانی

### پشتیبانی Group Policy
```powershell
# اعمال تنظیمات از طریق رجیستری Group Policy
Set-Ghost -SMBv1 -RDP -AutoRun -GroupPolicy

# تنظیمات پس از تازه‌سازی GP در سراسر دامنه اعمال می‌شود
gpupdate /force
```

### یکپارچگی Microsoft Intune
```powershell
# ایجاد سیاست‌های Intune برای تنظیمات Ghost
Set-IntuneGhost -Settings $GhostSettings -Interactive

# سیاست‌ها به طور خودکار روی دستگاه‌های مدیریت شده استقرار می‌یابند
```

### گزارش انطباق
```powershell
# تولید گزارش ارزیابی امنیت
Get-Ghost | Export-Csv -Path "SecurityAudit-$(Get-Date -Format 'yyyy-MM-dd').csv"

# گزارش وضعیت امنیتی Azure
Get-AzureGhost | Out-File "AzureSecurityReport.txt"
```

## 📚 بهترین شیوه‌ها

### قبل از استقرار
1. **مستندسازی وضعیت فعلی**: قبل از تغییرات `Get-Ghost` را اجرا کنید
2. **تست دقیق**: در محیط غیرتولیدی اعتبارسنجی کنید
3. **برنامه‌ریزی بازگشت**: بدانید چگونه هر تنظیم را برگردانید
4. **بررسی ذی‌نفعان**: اطمینان حاصل کنید که واحدهای تجاری تغییرات را تأیید می‌کنند

### در حین استقرار
1. **رویکرد مرحله‌ای**: ابتدا به گروه‌های آزمایشی استقرار دهید
2. **نظارت بر تأثیر**: مراقب شکایات کاربران یا مشکلات سیستم باشید
3. **مستندسازی مشکلات**: هر مشکلی را برای مراجعه آینده ثبت کنید
4. **ارتباط تغییرات**: کاربران را از بهبودهای امنیتی مطلع کنید

### پس از استقرار
1. **ارزیابی منظم**: به طور دوره‌ای `Get-Ghost` را برای تأیید تنظیمات اجرا کنید
2. **به‌روزرسانی مستندات**: پیکربندی‌های امنیتی فعلی را حفظ کنید
3. **بررسی اثربخشی**: برای حوادث امنیتی نظارت کنید
4. **بهبود مداوم**: تنظیمات را بر اساس چشم‌انداز تهدید تنظیم کنید

## 🔧 عیب‌یابی

### مشکلات رایج
- **خطاهای مجوز**: جلسه PowerShell بالا را تضمین کنید
- **وابستگی‌های سرویس**: برخی سرویس‌ها ممکن است وابستگی داشته باشند
- **سازگاری برنامه**: با برنامه‌های تجاری تست کنید
- **اتصال شبکه**: تأیید کنید که دسترسی راه دور همچنان کار می‌کند

### گزینه‌های بازیابی
```powershell
# در صورت نیاز سرویس‌های خاص را دوباره فعال کنید
Set-RDP -Enable
Set-SMBv1 -Enable
Set-AutoRun -Enable
Set-Macros -Enable
```

## 👨‍💻 درباره نویسنده

**Jim Tyler** - Microsoft MVP برای PowerShell
- **YouTube**: [@PowerShellEngineer](https://youtube.com/@PowerShellEngineer) (بیش از ۱۰٬۰۰۰ مشترک)
- **خبرنامه**: [PowerShell.News](https://powershell.news) - اطلاعات امنیتی هفتگی
- **نویسنده**: "PowerShell for Systems Engineers"
- **تجربه**: دهه‌ها تجربه در اتوماسیون PowerShell و امنیت ویندوز

## 📄 مجوز و سلب مسئولیت

### مجوز MIT
Ghost تحت مجوز MIT برای استفاده، تغییر و توزیع رایگان ارائه می‌شود.

### سلب مسئولیت امنیتی
- **بدون ضمانت**: Ghost "همان‌طور که هست" بدون هیچ نوع ضمانت ارائه می‌شود
- **تست الزامی**: همیشه ابتدا در محیط‌های غیرتولیدی تست کنید
- **راهنمایی حرفه‌ای**: برای استقرارهای تولیدی با متخصصان امنیت مشورت کنید
- **تأثیر عملیاتی**: نویسندگان مسئول هیچ اختلال عملیاتی نیستند
- **امنیت جامع**: Ghost یکی از اجزای استراتژی امنیتی کامل است

### پشتیبانی
- **مشکلات GitHub**: [گزارش اشکال یا درخواست ویژگی‌ها](https://github.com/jimrtyler/Ghost/issues)
- **مستندات**: برای کمک تفصیلی از `Get-Help <function> -Full` استفاده کنید
- **انجمن**: انجمن‌های جامعه PowerShell و امنیت

---

**🔒 موقعیت امنیتی خود را با Ghost تقویت کنید - اما همیشه ابتدا تست کنید.**

```powershell
# با ارزیابی شروع کنید، نه با فرضیات
Get-Ghost
```

**⭐ اگر Ghost به بهبود موقعیت امنیتی شما کمک می‌کند، به این مخزن ستاره بدهید!**